{
    "Integration Designer COM Functions": {
        "scope": "javascript",
        "prefix": "defcom",
        "body": [
            "function defCom() {",
            "  comObj = new HTTP(comRx);",
            "  comObj.OnConnectFunc = dOn;",
            "  comObj.OnDisconnectFunc = dOff;",
            "  comObj.OnConnectFailedFunc = dCnFail;",
            "  comObj.OnSSLHandshakeOKFunc = onSSLHdShkOK;",
            "  comObj.OnSSLHandshakeFailedFunc = onSSLHdShkFailed;",
            "  httpCon = new ScheduledEvent(opnCom, \"Periodic\", \"Seconds\", 1);",
            "  httpCon.Enable();",
            "}",
            "",
            "function dOn() {",
            "  log.Inf(\"Connected\");",
            "  isCntd = true;",
            "  comObj.StartSSLHandshake();",
            "}",
            "",
            "function dCnFail() {",
            "  log.Err(\"Unable to connect. Reconnecting...\");",
            "  httpCon.Enable();",
            "}",
            "",
            "function dOff() {",
            "  (comObj.Disconnect(), System.Sleep(100), comObj.Close());",
            "  log.Inf(\"Disconnected\");",
            "  isCntd = false;",
            "}",
            "",
            "function onSSLHdShkOK() {",
            "  log.Inf(\"SSL Handshake OK.\");",
            "  updPoll();",
            "  defWs(); // To be Implemented Later.",
            "}",
            "",
            "function onSSLHdShkFailed() {",
            "  log.Err(\"SSL HandShake Failed\");",
            "  isCntd = false;",
            "  if (comObj && comObj.OpenState) {",
            "    comObj.Close();",
            "  }",
            "  httpCon.Enable();",
            "}",
            "",
            "function opnCom(r) {",
            "  r = r || false;",
            "  r || comObj",
            "    ? (comObj.Disconnect(),",
            "      System.Sleep(100),",
            "      comObj.Close(),",
            "      System.Sleep(100))",
            "    : \"\";",
            "  comObj.Open(\"api.aaecosystem.com\", 443);",
            "  httpCon.Disable();",
            "}",
            "",
            "function updPoll() {",
            "  var lIDs = Object.keys(lID2uID);",
            "  log.Inf(\"access_token: \" + access_token);",
            "  for (var i = 0; i < lIDs.length; i++) {",
            "    sndAPIRqst(\"GET\", \"/locks/\" + lIDs[i]);",
            "  }",
            "  if (rqstArr.length && !rqstTmr.State) {",
            "    rqstTmr.Start(sndRqst, 500);",
            "  }",
            "}"
        ],
        "description": "Integration Designer COM Communication Functions"
    }
}